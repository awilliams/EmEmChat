var Quo=function(){function a(b,e){b=b||c;b.__proto__=a.prototype;b.selector=e||"";return b}function b(c){if(c){var e=b.getDomainSelector(c);return a(e,c)}return a()}var c=[];b.extend=function(a){Array.prototype.slice.call(arguments,1).forEach(function(b){for(key in b)a[key]=b[key]});return a};a.prototype=b.fn={};return b}();window.Quo=Quo;"$$"in window||(window.$$=Quo);
(function(a){function b(a){return a.filter(function(a){return void 0!==a&&null!==a})}var c=Object.prototype,d=[];a.toType=function(a){return c.toString.call(a).match(/\s([a-z|A-Z]+)/)[1].toLowerCase()};a.isOwnProperty=function(a,b){return c.hasOwnProperty.call(a,b)};a.getDomainSelector=function(c){var d=null,i=[1,9,11],g=a.toType(c);if("array"===g)d=b(c);else if("string"===g)d=a.query(document,c);else if(0<=i.indexOf(c.nodeType)||c===window)d=[c];return d};a.map=function(b,c){var d=[],g;if("array"===
a.toType(b))for(g=0;g<b.length;g++){var h=c(b[g],g);null!=h&&d.push(h)}else for(g in b)h=c(b[g],g),null!=h&&d.push(h);return 0<d.length?[].concat.apply([],d):d};a.each=function(b,c){var d;if("array"===a.toType(b))for(d=0;d<b.length&&!(!1===c.call(b[d],d,b[d]));d++);else for(d in b)if(!1===c.call(b[d],d,b[d]))break;return b};a.mix=function(){for(var b={},c=0,d=arguments.length;c<d;c++){var g=arguments[c],h;for(h in g)a.isOwnProperty(g,h)&&void 0!==g[h]&&(b[h]=g[h])}return b};a.fn.forEach=d.forEach;
a.fn.indexOf=d.indexOf;a.fn.map=function(b){return a.map(this,function(a,c){return b.call(a,c,a)})};a.fn.instance=function(a){return this.map(function(){return this[a]})};a.fn.filter=function(b){return a([].filter.call(this,function(c){return c.parentNode&&0<=a.query(c.parentNode,b).indexOf(c)}))}})(Quo);
(function(a){a.fn.attr=function(b,c){return"string"===a.toType(b)&&void 0===c?this[0].getAttribute(b):this.each(function(){this.setAttribute(b,c)})};a.fn.data=function(a,c){return this.attr("data-"+a,c)};a.fn.val=function(b){return"string"===a.toType(b)?this.each(function(){this.value=b}):0<this.length?this[0].value:null};a.fn.show=function(){return this.style("display","block")};a.fn.hide=function(){return this.style("display","none")};a.fn.height=function(){return this.offset().height};a.fn.width=
function(){return this.offset().width};a.fn.offset=function(){var a=this[0].getBoundingClientRect();return{left:a.left+window.pageXOffset,top:a.top+window.pageYOffset,width:a.width,height:a.height}};a.fn.remove=function(){return this.each(function(){null!=this.parentNode&&this.parentNode.removeChild(this)})}})(Quo);
(function(a){var b=/WebKit\/([\d.]+)/,c={android:/(Android)\s+([\d.]+)/,ipad:/(iPad).*OS\s([\d_]+)/,iphone:/(iPhone\sOS)\s([\d_]+)/,blackberry:/(BlackBerry).*Version\/([\d.]+)/,webos:/(webOS|hpwOS)[\s\/]([\d.]+)/},d=null;a.isMobile=function(){d=d||e();return d.isMobile};a.environment=function(){return d=d||e()};a.isOnline=function(){return navigator.onLine};var e=function(){var a=navigator.userAgent,d={},e=a.match(b);d.browser=e?e[0]:a;var h;for(os in c)if(e=a.match(c[os])){h={name:"iphone"===os||
"ipad"===os?"ios":os,version:e[2].replace("_",".")};break}d.os=h;d.isMobile=d.os?!0:!1;return d}})(Quo);
(function(a){a.fn.text=function(a){return!a?this[0].textContent:this.each(function(){this.textContent=a})};a.fn.html=function(b){return"string"===a.toType("value")?this.each(function(){this.innerHTML=b}):this[0].innerHTML};a.fn.append=function(b){return this.each(function(){if("string"===a.toType(b)){var c=document.createElement();c.innerHTML=b;this.appendChild(c.firstChild)}else this.parentNode.insertBefore(b)})};a.fn.prepend=function(b){return this.each(function(){if("string"===a.toType(b))this.innerHTML=
b+this.innerHTML;else{var c=this.parentNode;c.insertBefore(b,c.firstChild)}})};a.fn.empty=function(){return this.each(function(){this.innerHTML=null})}})(Quo);
(function(a){a.query=function(a,b){var c=document.querySelectorAll(b);return c=Array.prototype.slice.call(c)};a.fn.parent=function(a){var e=a?b(this):this.instance("parentNode");return c(e,a)};a.fn.siblings=function(a){var b=this.map(function(a,b){return Array.prototype.slice.call(b.parentNode.children).filter(function(a){return a!==b})});return c(b,a)};a.fn.children=function(a){var b=this.map(function(){return Array.prototype.slice.call(this.children)});return c(b,a)};a.fn.get=function(a){return void 0===
a?this:this[a]};a.fn.first=function(){return a(this[0])};a.fn.last=function(){return a(this[this.length-1])};a.fn.closest=function(b,c){var f=this[0],i=a(b);for(i.length||(f=null);f&&0>i.indexOf(f);)f=f!==c&&f!==document&&f.parentNode;return a(f)};a.fn.each=function(a){this.forEach(function(b,c){a.call(b,c,b)});return this};var b=function(b){for(var c=[];0<b.length;)b=a.map(b,function(a){if((a=a.parentNode)&&a!==document&&0>c.indexOf(a))return c.push(a),a});return c},c=function(b,c){return void 0===
c?a(b):a(b).filter(c)}})(Quo);
(function(a){function b(a,b){return 0<=b.split(/\s+/g).indexOf(a)}a.fn.addClass=function(a){return this.each(function(){b(a,this.className)||(this.className+=" "+a)})};a.fn.removeClass=function(a){return this.each(function(){if(b(a,this.className))this.className=this.className.replace(a," ")})};a.fn.toggleClass=function(a){return this.each(function(){this.className=b(a,this.className)?this.className.replace(a," "):this.className+(" "+a)})};a.fn.hasClass=function(a){return b(a,this[0].className)};
a.fn.style=function(a,b){return!b?this[0].style[a]||document.defaultView.getComputedStyle(this[0],"")[a]:this.each(function(){this.style[a]=b})}})(Quo);
(function(a){var b;function c(a,b){if(b.contentType)b.headers["Content-Type"]=b.contentType;b.dataType&&(b.headers.Accept=f[b.dataType]);for(header in b.headers)a.setRequestHeader(header,b.headers[header])}function d(a,b){a.onreadystatechange={};a.abort();b.error.call(b.context,"QuoJS \u00bb $$.ajax : timeout exceeded",a,b)}function e(a,c){var d=a.responseText;if(d&&c.dataType===b)try{d=JSON.parse(d)}catch(e){d=e,c.error.call(c.context,"Parse Error",a,c)}return d}b="json";var f={script:"text/javascript, application/javascript",
json:"application/json",xml:"application/xml, text/xml",html:"text/html",text:"text/plain"},i=0;a.ajaxSettings={type:"GET",async:!0,success:{},error:{},context:null,dataType:b,headers:{},xhr:function(){return new window.XMLHttpRequest},crossDomain:!1,timeout:0};a.ajax=function(b){var f=a.mix(a.ajaxSettings,b);if(/=\?/.test(f.url))return a.jsonp(f);var g=f.xhr();g.onreadystatechange=function(){if(4===g.readyState)if(clearTimeout(i),200===g.status){if(f.async){var a=e(g,f);f.success.call(f.context,
a,g)}}else f.error.call(f.context,"QuoJS \u00bb $$.ajax",g,f)};g.open(f.type,f.url,f.async);c(g,f);if(0<f.timeout)var i=setTimeout(function(){d(g,f)},f.timeout);g.send(f.data);return f.async?g:e(g,f)};a.jsonp=function(b){var c="jsonp"+ ++i,f=document.createElement("script"),e={abort:function(){a(f).remove();c in window&&(window[c]={})}},g;window[c]=function(d){clearTimeout(g);a(f).remove();delete window[c];b.success.call(b.context,d,e)};f.src=b.url.replace(/=\?/,"="+c);a("head").append(f);0<b.timeout&&
(g=setTimeout(function(){d(e,b)},b.timeout));return e};a.get=function(b,c,d,f){b+=g(c);return a.ajax({url:b,success:d,dataType:f})};a.post=function(b,c,d,f){return a.ajax({type:"POST",url:b,data:c,success:d,dataType:f,contentType:"application/x-www-form-urlencoded"})};a.json=function(c,d,f){c+=g(d);return a.ajax({url:c,success:f,dataType:b})};var g=function(a){var b="?",c;for(c in a)a.hasOwnProperty(c)&&("?"!==b&&(b+="&"),b+=c+"="+a[c]);return"?"===b?"":b}})(Quo);
(function(a){var b={touch:"touchstart",tap:"tap"},c=/complete|loaded|interactive/;["touch","tap"].forEach(function(c){a.fn[c]=function(e){a(document.body).delegate(this.selector,b[c],e);return this}});a.fn.on=function(b,c,f){return void 0===c||"function"===a.toType(c)?this.bind(b,c):this.delegate(c,b,f)};a.fn.off=function(b,c,f){return void 0===c||"function"===a.toType(c)?this.unbind(b,c):this.undelegate(c,b,f)};a.fn.ready=function(b){c.test(document.readyState)?b(a):document.addEventListener("DOMContentLoaded",
function(){b(a)},!1);return this}})(Quo);
(function(a){function b(b,c,f,e,h){var c=a.isMobile()?c:l[c],r=b._id||(b._id=i++),r=g[r]||(g[r]=[]),h=h&&h(f,c),c={event:c,callback:f,selector:e,proxy:d(h,f,b),delegate:h,index:r.length};r.push(c);b.addEventListener(c.event,c.proxy,!1)}function c(b,c,d,f){var c=a.isMobile()?c:l[c],h=b._id||(b._id=i++);e(h,c,d,f).forEach(function(a){delete g[h][a.index];b.removeEventListener(a.event,a.proxy,!1)})}function d(a,b,c){b=a||b;return function(a){var d=b.apply(c,[a].concat(a.data));!1===d&&a.preventDefault();
return d}}function e(a,b,c,d){return(g[a]||[]).filter(function(a){return a&&(!b||a.event==b)&&(!c||a.fn==c)&&(!d||a.selector==d)})}function f(b){var c=a.extend({originalEvent:b},b);a.each(h,function(a,d){c[a]=function(){this[d]=function(){return!0};return b[a].apply(b,arguments)};c[d]=function(){return!1}});return c}var i=1,g={},h={preventDefault:"isDefaultPrevented",stopImmediatePropagation:"isImmediatePropagationStopped",stopPropagation:"isPropagationStopped"},l={touchstart:"mousedown",touchmove:"mousemove",
touchend:"mouseup",tap:"click",doubletap:"dblclick",orientationchange:"resize"};a.Event=function(a){var b=document.createEvent("Events");b.initEvent(a,!0,!0,null,null,null,null,null,null,null,null,null,null,null,null);return b};a.fn.bind=function(a,c){return this.each(function(){b(this,a,c)})};a.fn.unbind=function(a,b){return this.each(function(){c(this,a,b)})};a.fn.delegate=function(c,d,h){return this.each(function(e,g){b(g,d,h,c,function(b){return function(d){var h=a(d.target).closest(c,g).get(0);
if(h){var e=a.extend(f(d),{currentTarget:h,liveFired:g});return b.apply(h,[e].concat([].slice.call(arguments,1)))}}})})};a.fn.undelegate=function(a,b,d){return this.each(function(){c(this,b,d,a)})};a.fn.trigger=function(b){a.isMobile()||console.log("Event "+b+" captured.");"string"===a.toType(b)&&(b=a.Event(b));return this.each(function(){this.dispatchEvent(b)})}})(Quo);
(function(a){var b,c,d,e,f,i,g;function h(h){var l=Date.now(),q=l-(b||l),h=a.isMobile()?h.touches[0]:h;m&&clearTimeout(m);c=a("tagName"in h.target?h.target:h.target.parentNode);d=h.pageX;e=h.pageY;f=0<q&&250>=q?!0:!1;b=l;i=void 0;g=void 0;setTimeout(n,r)}function l(b){b=a.isMobile()?b.touches[0]:b;i=b.pageX;g=b.pageY}function p(){f?(c.trigger("doubleTap"),b=void 0,c=void 0,d=void 0,e=void 0,f=void 0,i=void 0,g=void 0):0<i||0<g?((30<Math.abs(d-i)||30<Math.abs(e-g))&&c.trigger("swipe")&&c.trigger("swipe"+
o(d,i,e,g)),d=i=e=g=b=0,b=void 0,c=void 0,d=void 0,e=void 0,f=void 0,i=void 0,g=void 0):(c.trigger("tap"),m=setTimeout(function(){m=null;b=void 0;c=void 0;d=void 0;e=void 0;f=void 0;i=void 0;g=void 0},250))}function s(){b=void 0;c=void 0;d=void 0;e=void 0;f=void 0;i=void 0;g=void 0;clearTimeout(m)}function o(a,b,c,d){var f=Math.abs(a-b),h=Math.abs(c-d);return f>=h?0<a-b?"Left":"Right":0<c-d?"Up":"Down"}function n(){b&&Date.now()-b>=r&&(c.trigger("longTap"),b=void 0,c=void 0,d=void 0,e=void 0,f=void 0,
i=void 0,g=void 0)}b=void 0;c=void 0;d=void 0;e=void 0;f=void 0;i=void 0;g=void 0;var m,r=750;"swipe,swipeLeft,swipeRight,swipeUp,swipeDown,doubleTap,longTap".split(",").forEach(function(b){a.fn[b]=function(a){return this.on(b,a)}});a(document).ready(function(){var b=a(document.body);b.bind("touchstart",h);b.bind("touchmove",l);b.bind("touchend",p);b.bind("touchcancel",s)})})(Quo);(function(){var a=Math,b=/webkit/i.test(navigator.appVersion)?"webkit":/firefox/i.test(navigator.userAgent)?"Moz":"opera"in window?"O":"";/android/gi.test(navigator.appVersion);var c=/iphone|ipad/gi.test(navigator.appVersion),d=/playbook/gi.test(navigator.appVersion),e=/hp-tablet/gi.test(navigator.appVersion),f="WebKitCSSMatrix"in window&&"m11"in new WebKitCSSMatrix,i="ontouchstart"in window&&!e,g=b+"Transform"in document.documentElement.style,h=c||d,l=function(){return window.requestAnimationFrame||
window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a){return setTimeout(a,17)}}(),p=window.cancelRequestAnimationFrame||window.webkitCancelAnimationFrame||window.webkitCancelRequestAnimationFrame||window.mozCancelRequestAnimationFrame||window.oCancelRequestAnimationFrame||window.msCancelRequestAnimationFrame||clearTimeout,s="onorientationchange"in window?"orientationchange":"resize",o=i?"touchstart":"mousedown",
n=i?"touchmove":"mousemove",m=i?"touchend":"mouseup",r=i?"touchcancel":"mouseup",u="translate"+(f?"3d(":"("),v=f?",0)":")",c=function(a,c){var d;this.wrapper="object"==typeof a?a:document.getElementById(a);this.wrapper.style.overflow="hidden";this.scroller=this.wrapper.children[0];this.options={hScroll:!0,vScroll:!0,x:0,y:0,bounce:!0,bounceLock:!1,momentum:!0,lockDirection:!0,useTransform:!0,useTransition:!1,onRefresh:null,onBeforeScrollStart:function(a){for(var b=a.target;1!=b.nodeType;)b=b.parentNode;
"SELECT"!=b.tagName&&"INPUT"!=b.tagName&&"TEXTAREA"!=b.tagName&&a.preventDefault()},onScrollStart:null,onBeforeScrollMove:null,onScrollMove:null,onBeforeScrollEnd:null,onScrollEnd:null,onTouchEnd:null,onDestroy:null};for(d in c)this.options[d]=c[d];this.x=this.options.x;this.y=this.options.y;this.options.useTransform=g?this.options.useTransform:!1;this.options.hScrollbar=this.options.hScroll&&this.options.hScrollbar;this.options.vScrollbar=this.options.vScroll&&this.options.vScrollbar;this.options.useTransition=
h&&this.options.useTransition;this.scroller.style[b+"TransitionProperty"]=this.options.useTransform?"-"+b.toLowerCase()+"-transform":"top left";this.scroller.style[b+"TransitionDuration"]="0";this.scroller.style[b+"TransformOrigin"]="0 0";this.options.useTransition&&(this.scroller.style[b+"TransitionTimingFunction"]="cubic-bezier(0.33,0.66,0.66,1)");this.options.useTransform?this.scroller.style[b+"Transform"]=u+this.x+"px,"+this.y+"px"+v:this.scroller.style.cssText+=";position:absolute;top:"+this.y+
"px;left:"+this.x+"px";this.refresh();this._bind(s,window);this._bind(o);i||this._bind("mouseout",this.wrapper)};c.prototype={enabled:!0,x:0,y:0,steps:[],scale:1,handleEvent:function(a){switch(a.type){case o:if(!i&&0!==a.button)break;this._start(a);break;case n:this._move(a);break;case m:case r:this._end(a);break;case s:this._resize();break;case "mouseout":this._mouseout(a);break;case "webkitTransitionEnd":this._transitionEnd(a)}},_resize:function(){this.refresh()},_pos:function(a,c){a=this.hScroll?
a:0;c=this.vScroll?c:0;this.options.useTransform?this.scroller.style[b+"Transform"]=u+a+"px,"+c+"px"+v+" scale("+this.scale+")":(a>>=0,c>>=0,this.scroller.style.left=a+"px",this.scroller.style.top=c+"px");this.x=a;this.y=c},_start:function(a){var c=i?a.touches[0]:a,d,f;if(this.enabled){this.options.onBeforeScrollStart&&this.options.onBeforeScrollStart.call(this,a);this.options.useTransition&&this._transitionTime(0);this.zoomed=this.animating=this.moved=!1;this.dirY=this.dirX=this.absDistY=this.absDistX=
this.distY=this.distX=0;if(this.options.momentum&&(this.options.useTransform?(d=getComputedStyle(this.scroller,null)[b+"Transform"].replace(/[^0-9-.,]/g,"").split(","),f=1*d[4],d=1*d[5]):(f=1*getComputedStyle(this.scroller,null).left.replace(/[^0-9-]/g,""),d=1*getComputedStyle(this.scroller,null).top.replace(/[^0-9-]/g,"")),f!=this.x||d!=this.y))this.options.useTransition?this._unbind("webkitTransitionEnd"):p(this.aniTime),this.steps=[],this._pos(f,d);this.startX=this.x;this.startY=this.y;this.pointX=
c.pageX;this.pointY=c.pageY;this.startTime=a.timeStamp||Date.now();this.options.onScrollStart&&this.options.onScrollStart.call(this,a);this._bind(n);this._bind(m);this._bind(r)}},_move:function(b){var c=i?b.touches[0]:b,d=c.pageX-this.pointX,f=c.pageY-this.pointY,h=this.x+d,e=this.y+f,g=b.timeStamp||Date.now();this.options.onBeforeScrollMove&&this.options.onBeforeScrollMove.call(this,b);this.pointX=c.pageX;this.pointY=c.pageY;if(0<h||h<this.maxScrollX)h=this.options.bounce?this.x+d/2:0<=h||0<=this.maxScrollX?
0:this.maxScrollX;if(0<e||e<this.maxScrollY)e=this.options.bounce?this.y+f/2:0<=e||0<=this.maxScrollY?0:this.maxScrollY;if(6>this.absDistX&&6>this.absDistY)this.distX+=d,this.distY+=f,this.absDistX=a.abs(this.distX),this.absDistY=a.abs(this.distY);else{if(this.options.lockDirection)if(this.absDistX>this.absDistY+5)e=this.y,f=0;else if(this.absDistY>this.absDistX+5)h=this.x,d=0;this.moved=!0;this._pos(h,e);this.dirX=0<d?-1:0>d?1:0;this.dirY=0<f?-1:0>f?1:0;if(300<g-this.startTime)this.startTime=g,this.startX=
this.x,this.startY=this.y;this.options.onScrollMove&&this.options.onScrollMove.call(this,b)}},_end:function(b){if(!(i&&0!=b.touches.length)){var c=i?b.changedTouches[0]:b,d,f,h={dist:0,time:0},e={dist:0,time:0},g=(b.timeStamp||Date.now())-this.startTime;d=this.x;f=this.y;this._unbind(n);this._unbind(m);this._unbind(r);this.options.onBeforeScrollEnd&&this.options.onBeforeScrollEnd.call(this,b);if(this.moved){if(300>g&&this.options.momentum){h=d?this._momentum(d-this.startX,g,-this.x,this.scrollerW-
this.wrapperW+this.x,this.options.bounce?this.wrapperW:0):h;e=f?this._momentum(f-this.startY,g,-this.y,0>this.maxScrollY?this.scrollerH-this.wrapperH+this.y:0,this.options.bounce?this.wrapperH:0):e;d=this.x+h.dist;f=this.y+e.dist;if(0<this.x&&0<d||this.x<this.maxScrollX&&d<this.maxScrollX)h={dist:0,time:0};if(0<this.y&&0<f||this.y<this.maxScrollY&&f<this.maxScrollY)e={dist:0,time:0}}h.dist||e.dist?(c=a.max(a.max(h.time,e.time),10),this.scrollTo(d>>0,f>>0,c)):this._resetPos(200)}else{if(i){for(d=c.target;1!=
d.nodeType;)d=d.parentNode;if("SELECT"!=d.tagName&&"INPUT"!=d.tagName&&"TEXTAREA"!=d.tagName)f=document.createEvent("MouseEvents"),f.initMouseEvent("click",!0,!0,b.view,1,c.screenX,c.screenY,c.clientX,c.clientY,b.ctrlKey,b.altKey,b.shiftKey,b.metaKey,0,null),f._fake=!0,d.dispatchEvent(f)}this._resetPos(200)}this.options.onTouchEnd&&this.options.onTouchEnd.call(this,b)}},_resetPos:function(a){var b=0<=this.x?0:this.x<this.maxScrollX?this.maxScrollX:this.x,c=0<=this.y||0<this.maxScrollY?0:this.y<this.maxScrollY?
this.maxScrollY:this.y;if(b==this.x&&c==this.y){if(this.moved)this.options.onScrollEnd&&this.options.onScrollEnd.call(this),this.moved=!1}else this.scrollTo(b,c,a||0)},_mouseout:function(a){var b=a.relatedTarget;if(b)for(;b=b.parentNode;)if(b==this.wrapper)return;this._end(a)},_transitionEnd:function(a){a.target==this.scroller&&(this._unbind("webkitTransitionEnd"),this._startAni())},_startAni:function(){var b=this,c=b.x,d=b.y,f=Date.now(),h,e,g;if(!b.animating)if(b.steps.length){h=b.steps.shift();
if(h.x==c&&h.y==d)h.time=0;b.animating=!0;b.moved=!0;b.options.useTransition?(b._transitionTime(h.time),b._pos(h.x,h.y),b.animating=!1,h.time?b._bind("webkitTransitionEnd"):b._resetPos(0)):(g=function(){var i=Date.now();if(i>=f+h.time)b._pos(h.x,h.y),b.animating=!1,b.options.onAnimationEnd&&b.options.onAnimationEnd.call(b),b._startAni();else if(i=(i-f)/h.time-1,e=a.sqrt(1-i*i),i=(h.x-c)*e+c,b._pos(i,(h.y-d)*e+d),b.animating)b.aniTime=l(g)},g())}else b._resetPos(400)},_transitionTime:function(a){this.scroller.style[b+
"TransitionDuration"]=a+"ms"},_momentum:function(b,c,d,f,h){var c=a.abs(b)/c,e=c*c/0.0012,g=0,g=0;0<b&&e>d?(d+=h/(6/(6.0E-4*(e/c))),c=c*d/e,e=d):0>b&&e>f&&(f+=h/(6/(6.0E-4*(e/c))),c=c*f/e,e=f);return{dist:e*(0>b?-1:1),time:c/6.0E-4>>0}},_offset:function(a){for(var b=-a.offsetLeft,c=-a.offsetTop;a=a.offsetParent;)b-=a.offsetLeft,c-=a.offsetTop;return{left:b,top:c}},_bind:function(a,b,c){(b||this.scroller).addEventListener(a,this,!!c)},_unbind:function(a,b,c){(b||this.scroller).removeEventListener(a,
this,!!c)},destroy:function(){this.scroller.style[b+"Transform"]="";this._unbind(s,window);this._unbind(o);this._unbind(n);this._unbind(m);this._unbind(r);this._unbind("mouseout",this.wrapper);this.options.useTransition&&this._unbind("webkitTransitionEnd");this.options.onDestroy&&this.options.onDestroy.call(this)},refresh:function(){var a;this.wrapperW=this.wrapper.clientWidth;this.wrapperH=this.wrapper.clientHeight;this.scrollerW=this.scroller.offsetWidth;this.scrollerH=this.scroller.offsetHeight;
this.maxScrollX=this.wrapperW-this.scrollerW;this.maxScrollY=this.wrapperH-this.scrollerH;this.dirY=this.dirX=0;this.hScroll=this.options.hScroll&&0>this.maxScrollX;this.vScroll=this.options.vScroll&&(!this.options.bounceLock&&!this.hScroll||this.scrollerH>this.wrapperH);a=this._offset(this.wrapper);this.wrapperOffsetLeft=-a.left;this.wrapperOffsetTop=-a.top;this.scroller.style[b+"TransitionDuration"]="0";this._resetPos(200)},scrollTo:function(a,b,c,d){var f=a;this.stop();f.length||(f=[{x:a,y:b,time:c,
relative:d}]);for(a=0,b=f.length;a<b;a++){if(f[a].relative)f[a].x=this.x-f[a].x,f[a].y=this.y-f[a].y;this.steps.push({x:f[a].x,y:f[a].y,time:f[a].time||0})}this._startAni()},scrollToElement:function(b,c){var d;if(b=b.nodeType?b:this.scroller.querySelector(b))d=this._offset(b),d.left+=this.wrapperOffsetLeft,d.top+=this.wrapperOffsetTop,d.left=0<d.left?0:d.left<this.maxScrollX?this.maxScrollX:d.left,d.top=0<d.top?0:d.top<this.maxScrollY?this.maxScrollY:d.top,c=void 0===c?a.max(2*a.abs(d.left),2*a.abs(d.top)):
c,this.scrollTo(d.left,d.top,c)},disable:function(){this.stop();this._resetPos(0);this.enabled=!1;this._unbind(n);this._unbind(m);this._unbind(r)},enable:function(){this.enabled=!0},stop:function(){p(this.aniTime);this.steps=[];this.animating=this.moved=!1}};"undefined"!==typeof exports?exports.iScroll=c:window.iScroll=c})();/*
   http://www.github.com/tapquo/lungo/blob/master/LICENSE.txt
 @version   1.1
 @link      https://github.com/TapQuo/Lungo.js

 @author   Javier Jimenez Villar <javi@tapquo.com> || @soyjavi
 @author   Guillermo Pascual <pasku@tapquo.com> || @pasku1
*/
var LUNGO=LUNGO||{};LUNGO.VERSION="1.1";LUNGO.Attributes||(LUNGO.Attributes={});LUNGO.Data||(LUNGO.Data={});LUNGO.Sugar||(LUNGO.Sugar={});LUNGO.View||(LUNGO.View={});LUNGO.Device||(LUNGO.Device={});LUNGO.App=function(a){var b={id:1,name:"lungo_app",version:1,icon:""};return{init:function(c){b=a.Core.mix(b,c);a.Boot()},get:function(a){return b[a]}}}(LUNGO);
LUNGO.Core=function(a,b){var c=Array.prototype,d=function(a,c){return b.isOwnProperty(a,c)},e=function(a){return b.toType(a)},f=function(a){return c.slice.call(a,0)};return{log:function(b,c){if(!a.Core.isMobile())console[1===b?"log":2===b?"warn":"error"](c)},execute:function(){var a=f(arguments),b=a.shift();"function"===e(b)&&b.apply(null,a)},bind:function(a,b){return function(){return b.apply(a,f(arguments))}},mix:function(){for(var a=a||{},b=0,c=arguments.length;b<c;b++){var f=arguments[b],e;for(e in f)d(f,
e)&&(a[e]=f[e])}return a},isOwnProperty:d,toType:e,toArray:f,isMobile:function(){return b.isMobile()},environment:function(){return b.environment()}}}(LUNGO,Quo);LUNGO.dom=function(a){return $$(a)};LUNGO.Service=function(a,b){return{get:function(a,d,e,f){return b.get(a,d,e,f)},post:function(a,d,e,f){return b.post(a,d,e,f)},json:function(a,d,e){return b.json(a,d,e)},Settings:b.ajaxSettings}}(LUNGO,Quo);
LUNGO.Router=function(a){var b=function(b){var d=!1;0<a.dom(b).length?d=!0:a.Core.log(3,"Lungo.Router ERROR: The target "+b+" does not exists.");return d};return{section:function(c){c=c.indexOf("#")?"#"+c:c;b("section"+c)&&(a.dom(a.Router.History.current()).removeClass("show").addClass("hide"),a.dom(c).addClass("show"),a.Router.History.add(c))},article:function(c,d){b(c+" article"+d)&&a.View.Article.show(c,d)},back:function(){a.dom(a.Router.History.current()).removeClass("show");a.Router.History.removeLast();
a.dom(a.Router.History.current()).removeClass("hide").addClass("show")}}}(LUNGO);LUNGO.Router.History=function(){var a=[],b=function(){return a[a.length-1]};return{add:function(c){c!==b()&&a.push(c)},current:b,removeLast:function(){a.length-=1}}}();
LUNGO.View.Article=function(a){return{show:function(b,c){var d=b+" a";a.dom(d).removeClass("current");d=a.dom(d+'[href="'+c+'"]');d.addClass("current");(d=d.data("title"))&&a.dom(b+" header .title, "+b+" footer .title").text(d);a.dom(b+" article").removeClass("current");a.dom(c).addClass("current")}}}(LUNGO);
LUNGO.View.Resize=function(a){return{scroll:function(b){var c=b.children().first(),d=c.children().first();if(a.View.Scroll.isHorizontal(b))d=c.children().length*d.width(),c.style("width",d+"px");else{var e=c.children().length,b=Math.floor(b.width()/d.width()),d=Math.ceil(e/b)*d.height();c.style("height",d+"px")}},article:function(a,c,d,e){c=a.children(c);0<c.length&&(e=c[e](),a.children("article").style(d,e+"px"))},toolbars:function(){for(var b,c=a.dom(".toolbar nav"),d=0,e=c.length;d<e;d++){b=a.dom(c[d]);
var f=b.children();b=b.width()/f.length;f.style("width",b+"px")}}}}(LUNGO);LUNGO.View.Template=function(a){var b={};return{create:function(a,d){b[a]=d},exists:function(a){return b[a]?!0:!1},get:function(a){return b[a]},binding:function(b,d,e,f){a.View.Template.Binding.create(b,d,e,f)}}}(LUNGO);
LUNGO.View.Template.Binding=function(a,b){var c=/\{{.*?\}}/gi,d=function(b,c,d,h,l){if(a.View.Template.exists(d)){var d=a.View.Template.get(d),p=a.Core.toType(h);if("array"===p){for(var p="",s=0,o=h.length;s<o;s++)p+=e(h[s],d);h=p}else"object"===p?h=e(h,d):(a.Core.log(3,"View.Template ERROR >> No type defined."),h=void 0);c=a.dom("#"+c);b.call(c,h);a.Core.execute(l)}else a.Core.log(3,"lng.View.Template.binding: id "+d+" not exists")},e=function(b,d){var e,h;for(h in b)a.Core.isOwnProperty(b,h)&&(e=
RegExp("{{"+h+"}}","g"),d=d.replace(e,b[h]));return d.replace(c,"")};return{create:function(a,c,e,h){d(b.fn.html,a,c,e,h)},append:function(a,c,e,h){d(b.fn.append,a,c,e,h)},dataAttribute:function(a,b){var c=a.data(b.tag);c&&(c=b.html.replace("{{value}}",c),a.prepend(c))}}}(LUNGO,Quo);
LUNGO.View.Template.List=function(a){var b=null,c=function(){var a=b.order_field,c="desc"===b.order_type?-1:1;a&&c&&b.data.sort(function(b,i){return b[a]<i[a]?-c:b[a]>i[a]?c:0})};return{create:function(d){b=d;b.container_id+="_list";var d=!1,e=!!a.dom(b.container_id),f=a.View.Template.exists(b.template_id);if(e&&f&&(a.dom("#"+b.container_id).html(""),e=a.Core.toType(b.data),"array"===e||"object"===e))d=!0;d&&(c(),a.View.Template.Binding.create(b.container_id,b.template_id,b.data),d=a.dom("#"+b.container_id).parent().attr("id"),
a.View.Scroll.create(d,{snap:"li"}))}}}(LUNGO);
LUNGO.View.Scroll=function(a){var b={hScroll:!1,vScroll:!1,useTransition:!0,momentum:!0,lockDirection:!0,fixedScrollbar:!0,fadeScrollbar:!0,hideScrollbar:!0},c=function(a){return a.hasClass("horizontal")?!0:!1},d=function(b,c){a.Data.Cache.exists("scrolls")||a.Data.Cache.set("scrolls",{});var d=a.Data.Cache.get("scrolls");d[b]=new iScroll(b,c);a.Data.Cache.set("scrolls",d)};return{create:function(e,f){if(e){var i=a.dom("#"+e);setTimeout(function(){var g=!1,h=i[0];if(h.clientHeight<h.scrollHeight){var g=
!0,l=h.scrollHeight+90;a.dom(h).children().first().style("height",l+"px")}g&&(g=f,h=c(i)?"hScroll":"vScroll",g||(g={}),g[h]=!0,f=g=a.Core.mix(b,g),d(e,f))},100)}else a.Core.log(3,"ERROR: Impossible to create a <scroll> without ID")},update:function(b,c){var i=a.dom("#"+b),g=i.children().first();0===g.length&&(i.html('<div id="'+b+'_scrl"></div>'),g=i.children().first());g.html(c);a.View.Resize.scroll(i);!a.Data.Cache.get("scrolls",b)&&d(b);a.Data.Cache.get("scrolls",b).refresh()},remove:function(b){a.Data.Cache.exists("scrolls")&&
(a.Data.Cache.get("scrolls",b).destroy(),a.Data.Cache.remove("scrolls",b))},isHorizontal:c}}(LUNGO);LUNGO.View.Aside=function(a){return{toggle:function(b){a.dom(b+" article").toggleClass("aside")}}}(LUNGO);LUNGO.View.Element=function(a){return{count:function(b,c){var d=a.dom(b);if(d)if(0<c){var e=d.children(".bubble.count");0<e.length?e.html(c):(e=LUNGO.Attributes.Data.Count.html.replace("{{value}}",c),d.append(e))}else d.children(".bubble.count").remove()}}}(LUNGO);
LUNGO.Attributes.Data={Search:{tag:"search",selector:".list",html:'<li class="search {{value}}"><input type="search" placeholder="Search..."><a href="#" class="button" data-icon="search"></a></li>'},Count:{tag:"count",selector:"*",html:'<span class="bubble count">{{value}}</span>'},Search:{tag:"search",selector:"*",html:'<input type="search" placeholder="{{value}}"/><a href="#" class="button" data-icon="search"></a>'},Icon:{tag:"icon",selector:"*",html:'<span class="icon {{value}}"></span>'},Image:{tag:"image",
selector:"*",html:'<img src="{{value}}" class="icon" />'},Title:{tag:"title",selector:"header, footer, article",html:'<span class="title">{{value}}</span>'},Back:{tag:"back",selector:"header, footer",html:'<a href="#back" data-target="section" class="onleft button"><span class="icon {{value}}"></span></a>'}};
LUNGO.Data.Cache=function(a){var b={},c=function(a,c){return 1===arguments.length?b[a]:b[arguments[0]][arguments[1]]},d=function(a){return b[a]?!0:!1};return{set:function(e,f){b[e]=d(e)?a.Core.mix(c(e),f):f},get:c,remove:function(a,c){1===arguments.length?delete b[a]:delete b[arguments[0]][arguments[1]]},exists:d}}(LUNGO);
LUNGO.Data.Sql=function(a){var b={name:"lungo_db",version:"1.0",size:65536,schema:[]},c=null,d=function(b,d){a.Core.log(1,"lng.Data.Sql >> "+b);c.transaction(function(a){a.executeSql(b,[],function(a,b){f(d,b)},g)})},e=function(b,c){var d="",f;for(f in b)if(a.Core.isOwnProperty(b,f)){var e=b[f];d&&(d+=" "+c+" ");d+=f+"=";d+=isNaN(e)?'"'+e+'"':e}return d},f=function(b,c){"function"===a.Core.toType(b)&&setTimeout(b,100,c)},i=function(b,c){var f="",e="",g;for(g in c)if(a.Core.isOwnProperty(c,g)){var i=
c[g],f=f+(f?", "+g:g);e&&(e+=", ");e+=isNaN(i)?'"'+i+'"':i}d("INSERT INTO "+b+" ("+f+") VALUES ("+e+")")},g=function(b,c){a.Core.log(3,"lng.Data.Sql >> "+c.code+": "+c.message)};return{init:function(f){b=a.Core.mix(b,f);if(c=openDatabase(b.name,b.version,b.name,b.size)){var f=b.schema,e=f.length;if(e)for(var g=0;g<e;g++){var i=f[g];!0===i.drop&&d("DROP TABLE IF EXISTS "+i.name);var o=i.name,i=i.fields,n="",m=void 0;for(m in i)a.Core.isOwnProperty(i,m)&&(n&&(n+=", "),n+=m+" "+i[m]);d("CREATE TABLE IF NOT EXISTS "+
o+" ("+n+");")}}else a.Core.log(3,"lng.Data.Sql >> Failed to connect to database.")},select:function(a,b,c){b=b?" WHERE "+e(b,"AND"):"";d("SELECT * FROM "+a+b,function(a){for(var b=[],d=0,e=a.rows.length;d<e;d++)b.push(a.rows.item(d));f(c,b)})},insert:function(b,c){if("object"===a.Core.toType(c))i(b,c);else for(row in c)i(b,c[row])},update:function(a,b,c){a="UPDATE "+a+" SET "+e(b,",");c&&(a+=" WHERE "+e(c,"AND"));d(a)},drop:function(a,b){var c=b?" WHERE "+e(b,"AND"):"";d("DELETE FROM "+a+c+";")},
execute:d}}(LUNGO);LUNGO.Data.Storage=function(){return{}}(LUNGO);LUNGO.Boot=function(a){return function(){a.Boot.Layout.start();a.Boot.Events.start();a.Boot.Data.start();a.Boot.Section.start();a.Boot.Article.start();a.Boot.Stats.start()}}(LUNGO);LUNGO.Boot.Stats=function(a){var b=function(){a.Service.post("http://www.lungojs.com/stats/",{name:a.App.get("name"),version:a.App.get("version"),icon:a.App.get("icon")},function(){})};return{start:function(){a.Core.isMobile()&&b()}}}(LUNGO);
LUNGO.Boot.Layout=function(a){var b=null,c=null,d=function(){if(!location.hash||!b.addEventListener){b.scrollTo(0,1);var a=1,d=setInterval(function(){c.body&&(clearInterval(d),a="scrollTop"in c.body?c.body.scrollTop:1,b.scrollTo(0,1===a?0:1))},15);b.addEventListener("load",function(){setTimeout(function(){b.scrollTo(0,1===a?0:1)},0)},!1)}};return{start:function(){if(a.Core.isMobile())b=window,c=b.document,356==b.innerHeight&&(a.dom("body").style("height","416px"),d())}}}(LUNGO);
LUNGO.Boot.Article=function(a){var b=function(b,c){for(var d=a.dom(b),e=0,l=d.length;e<l;e++){var p=a.dom(d[e]);a.Core.execute(c,p)}},c=function(a){if(0===a.children().length){var b=a.attr("id");a.append('<ul id="'+b+'_list"></ul>')}},d=function(b){b=b.attr("id");a.View.Scroll.create(b)},e=function(a){a.append("<span>&nbsp;</span>")};return{start:function(){b("article.list",c);b(".scrollable",d);b(".checkbox, .radio",e)}}}(LUNGO);
LUNGO.Boot.Data=function(a){return{start:function(){var b=a.Attributes.Data,c;for(c in b)if(a.Core.isOwnProperty(b,c))for(var d=b[c],e=a.dom(d.selector),f=0,i=e.length;f<i;f++){var g=a.dom(e[f]);a.View.Template.Binding.dataAttribute(g,d)}}}}(LUNGO);
LUNGO.Boot.Events=function(a){var b=function(a){a.preventDefault()},c=function(){a.View.Resize.toolbars()},d=function(b){var c=a.dom(this),c=f(c);a.View.Aside.toggle(c);b.preventDefault()},e=function(b){var c=a.dom(this);switch(c.data("target")){case "section":var d=c.attr("href");"#back"===d?a.Router.back():a.Router.section(d);break;case "article":d=f(c);c=c.attr("href");a.Router.article(d,c);break;case "aside":d=f(c),a.View.Aside.toggle(d)}b.preventDefault()},f=function(a){return"#"+a.parent("section").attr("id")};
return{start:function(){a.dom(document).on("touchmove",b);a.dom(window).on("orientationchange",c);a.dom("aside a[href][data-target]").tap(d);a.dom("a[href][data-target]").tap(e)}}}(LUNGO);
LUNGO.Boot.Section=function(a){return{start:function(){var b=a.dom("section"),c=b.first(),d="#"+c.attr("id");c.addClass("current");a.Router.History.add(d);a.Core.isMobile()&&(c=a.Core.environment(),"ios"===c.os.name&&"5."<=c.os.version&&b.style("position","fixed"));c=0;for(d=b.length;c<d;c++)a.dom(b[c]).children("article").first().addClass("current");a.dom("aside").addClass("show");a.View.Resize.toolbars()}}}(LUNGO);LUNGO.Sugar.Growl=function(a,b){var c=[],d=function(){g(".growl .modal");g(".growl .notify");setTimeout(function(){a.dom(".growl").style("display","none")},300)},e=function(b){var c=a.dom(".growl");"none"===c.style("display")&&c.show();b&&c.addClass("modal")},f=function(a){for(var c="",d=0,f=a.length;d<f;d++)var e="growl_option_"+d,e=e!==b?'id="'+e+'"':"",c=c+('<a href="#" '+e+' class="button '+a[d].color+'"><span class="icon '+a[d].icon+'"></span>'+a[d].name+"</a>");return c},i=function(a,c){a!=
b&&0!=a&&(c===b&&(c="LUNGO.Sugar.Growl.hide()"),setTimeout(c,1E3*a))},g=function(b){b=a.dom(b);b.hasClass("show")&&b.removeClass("show")};a.dom("body").append('<div class="growl"><div class="modal"></div><div class="notify"></div></div>');(function(){a.dom(".growl .notify").bind("click",function(){a.dom(".growl .notify").removeClass("show")});a.dom(".growl .modal a").tap(function(b){if(""!==a.dom(this).attr("id"))id=a.dom(this).attr("id").replace(/growl_option_/g,""),setTimeout(c[id].callback,100);
else return b.preventDefault(),d(),!1})})();return{show:function(b,c,d,f,g,n){e(!0);var m=a.dom(".growl .modal");m.removeClass("show");m.removeClass("input");m.html('<span class="big icon '+d+'"></span><strong>'+b+"</strong><small>"+c+"</small>");f?m.addClass("working"):m.removeClass("working");m.show().addClass("show");i(g,n)},hide:d,notify:function(b,c,d,f,g,n){e(!1);var m=a.dom(".growl .notify");f&&m.addClass(f);m.html('<span class="icon '+d+'"></span><strong>'+b+"</strong><br/><small>"+c+"</small>");
setTimeout(function(){m.addClass("show")},300);i(g,n)},option:function(b,d){e(!0);c=d;var g=f(d),i=a.dom(".growl .modal");i.removeClass("working").removeClass("show");i.addClass("input").html("<strong>"+b+"</strong>"+g).show();setTimeout(function(){i.addClass("show")},300)},loading:function(){}}}(LUNGO);var swfobject=function(){function a(){if(!A){try{var a=k.getElementsByTagName("body")[0].appendChild(k.createElement("span"));a.parentNode.removeChild(a)}catch(b){return}A=!0;for(var a=E.length,c=0;c<a;c++)E[c]()}}function b(a){A?a():E[E.length]=a}function c(a){if(typeof t.addEventListener!=q)t.addEventListener("load",a,!1);else if(typeof k.addEventListener!=q)k.addEventListener("load",a,!1);else if(typeof t.attachEvent!=q)n(t,"onload",a);else if("function"==typeof t.onload){var b=t.onload;t.onload=
function(){b();a()}}else t.onload=a}function d(){var a=k.getElementsByTagName("body")[0],b=k.createElement(w);b.setAttribute("type",D);var c=a.appendChild(b);if(c){var d=0;(function(){if(typeof c.GetVariable!=q){var f=c.GetVariable("$version");if(f)f=f.split(" ")[1].split(","),j.pv=[parseInt(f[0],10),parseInt(f[1],10),parseInt(f[2],10)]}else if(10>d){d++;setTimeout(arguments.callee,10);return}a.removeChild(b);c=null;e()})()}else e()}function e(){var a=z.length;if(0<a)for(var b=0;b<a;b++){var c=z[b].id,
d=z[b].callbackFn,e={success:!1,id:c};if(0<j.pv[0]){var l=o(c);if(l)if(m(z[b].swfVersion)&&!(j.wk&&312>j.wk)){if(u(c,!0),d)e.success=!0,e.ref=f(c),d(e)}else if(z[b].expressInstall&&i()){e={};e.data=z[b].expressInstall;e.width=l.getAttribute("width")||"0";e.height=l.getAttribute("height")||"0";if(l.getAttribute("class"))e.styleclass=l.getAttribute("class");if(l.getAttribute("align"))e.align=l.getAttribute("align");for(var p={},l=l.getElementsByTagName("param"),s=l.length,k=0;k<s;k++)"movie"!=l[k].getAttribute("name").toLowerCase()&&
(p[l[k].getAttribute("name")]=l[k].getAttribute("value"));g(e,p,c,d)}else h(l),d&&d(e)}else if(u(c,!0),d){if((c=f(c))&&typeof c.SetVariable!=q)e.success=!0,e.ref=c;d(e)}}}function f(a){var b=null;if((a=o(a))&&"OBJECT"==a.nodeName)typeof a.SetVariable!=q?b=a:(a=a.getElementsByTagName(w)[0])&&(b=a);return b}function i(){return!F&&m("6.0.65")&&(j.win||j.mac)&&!(j.wk&&312>j.wk)}function g(a,b,c,d){F=!0;I=d||null;M={success:!1,id:c};var f=o(c);if(f){"OBJECT"==f.nodeName?(C=l(f),G=null):(C=f,G=c);a.id=
K;if(typeof a.width==q||!/%$/.test(a.width)&&310>parseInt(a.width,10))a.width="310";if(typeof a.height==q||!/%$/.test(a.height)&&137>parseInt(a.height,10))a.height="137";k.title=k.title.slice(0,47)+" - Flash Player Installation";d=j.ie&&j.win?"ActiveX":"PlugIn";d="MMredirectURL="+t.location.toString().replace(/&/g,"%26")+"&MMplayerType="+d+"&MMdoctitle="+k.title;b.flashvars=typeof b.flashvars!=q?b.flashvars+("&"+d):d;if(j.ie&&j.win&&4!=f.readyState)d=k.createElement("div"),c+="SWFObjectNew",d.setAttribute("id",
c),f.parentNode.insertBefore(d,f),f.style.display="none",function(){4==f.readyState?f.parentNode.removeChild(f):setTimeout(arguments.callee,10)}();p(a,b,c)}}function h(a){if(j.ie&&j.win&&4!=a.readyState){var b=k.createElement("div");a.parentNode.insertBefore(b,a);b.parentNode.replaceChild(l(a),b);a.style.display="none";(function(){4==a.readyState?a.parentNode.removeChild(a):setTimeout(arguments.callee,10)})()}else a.parentNode.replaceChild(l(a),a)}function l(a){var b=k.createElement("div");if(j.win&&
j.ie)b.innerHTML=a.innerHTML;else if(a=a.getElementsByTagName(w)[0])if(a=a.childNodes)for(var c=a.length,d=0;d<c;d++)!(1==a[d].nodeType&&"PARAM"==a[d].nodeName)&&8!=a[d].nodeType&&b.appendChild(a[d].cloneNode(!0));return b}function p(a,b,c){var d,f=o(c);if(j.wk&&312>j.wk)return d;if(f){if(typeof a.id==q)a.id=c;if(j.ie&&j.win){var e="",g;for(g in a)if(a[g]!=Object.prototype[g])"data"==g.toLowerCase()?b.movie=a[g]:"styleclass"==g.toLowerCase()?e+=' class="'+a[g]+'"':"classid"!=g.toLowerCase()&&(e+=
" "+g+'="'+a[g]+'"');g="";for(var h in b)b[h]!=Object.prototype[h]&&(g+='<param name="'+h+'" value="'+b[h]+'" />');f.outerHTML='<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"'+e+">"+g+"</object>";H[H.length]=a.id;d=o(a.id)}else{h=k.createElement(w);h.setAttribute("type",D);for(var i in a)a[i]!=Object.prototype[i]&&("styleclass"==i.toLowerCase()?h.setAttribute("class",a[i]):"classid"!=i.toLowerCase()&&h.setAttribute(i,a[i]));for(e in b)b[e]!=Object.prototype[e]&&"movie"!=e.toLowerCase()&&
(a=h,g=e,i=b[e],c=k.createElement("param"),c.setAttribute("name",g),c.setAttribute("value",i),a.appendChild(c));f.parentNode.replaceChild(h,f);d=h}}return d}function s(a){var b=o(a);if(b&&"OBJECT"==b.nodeName)j.ie&&j.win?(b.style.display="none",function(){if(4==b.readyState){var c=o(a);if(c){for(var d in c)"function"==typeof c[d]&&(c[d]=null);c.parentNode.removeChild(c)}}else setTimeout(arguments.callee,10)}()):b.parentNode.removeChild(b)}function o(a){var b=null;try{b=k.getElementById(a)}catch(c){}return b}
function n(a,b,c){a.attachEvent(b,c);B[B.length]=[a,b,c]}function m(a){var b=j.pv,a=a.split(".");a[0]=parseInt(a[0],10);a[1]=parseInt(a[1],10)||0;a[2]=parseInt(a[2],10)||0;return b[0]>a[0]||b[0]==a[0]&&b[1]>a[1]||b[0]==a[0]&&b[1]==a[1]&&b[2]>=a[2]?!0:!1}function r(a,b,c,d){if(!j.ie||!j.mac){var f=k.getElementsByTagName("head")[0];if(f){c=c&&"string"==typeof c?c:"screen";d&&(J=x=null);if(!x||J!=c)d=k.createElement("style"),d.setAttribute("type","text/css"),d.setAttribute("media",c),x=f.appendChild(d),
j.ie&&j.win&&typeof k.styleSheets!=q&&0<k.styleSheets.length&&(x=k.styleSheets[k.styleSheets.length-1]),J=c;j.ie&&j.win?x&&typeof x.addRule==w&&x.addRule(a,b):x&&typeof k.createTextNode!=q&&x.appendChild(k.createTextNode(a+" {"+b+"}"))}}}function u(a,b){if(N){var c=b?"visible":"hidden";A&&o(a)?o(a).style.visibility=c:r("#"+a,"visibility:"+c)}}function v(a){return null!=/[\\\"<>\.;]/.exec(a)&&typeof encodeURIComponent!=q?encodeURIComponent(a):a}var q="undefined",w="object",D="application/x-shockwave-flash",
K="SWFObjectExprInst",t=window,k=document,y=navigator,L=!1,E=[function(){L?d():e()}],z=[],H=[],B=[],C,G,I,M,A=!1,F=!1,x,J,N=!0,j=function(){var a=typeof k.getElementById!=q&&typeof k.getElementsByTagName!=q&&typeof k.createElement!=q,b=y.userAgent.toLowerCase(),c=y.platform.toLowerCase(),d=c?/win/.test(c):/win/.test(b),c=c?/mac/.test(c):/mac/.test(b),b=/webkit/.test(b)?parseFloat(b.replace(/^.*webkit\/(\d+(\.\d+)?).*$/,"$1")):!1,f=!+"\u000b1",e=[0,0,0],g=null;if(typeof y.plugins!=q&&typeof y.plugins["Shockwave Flash"]==
w){if((g=y.plugins["Shockwave Flash"].description)&&!(typeof y.mimeTypes!=q&&y.mimeTypes[D]&&!y.mimeTypes[D].enabledPlugin))L=!0,f=!1,g=g.replace(/^.*\s+(\S+\s+\S+$)/,"$1"),e[0]=parseInt(g.replace(/^(.*)\..*$/,"$1"),10),e[1]=parseInt(g.replace(/^.*\.(.*)\s.*$/,"$1"),10),e[2]=/[a-zA-Z]/.test(g)?parseInt(g.replace(/^.*[a-zA-Z]+(.*)$/,"$1"),10):0}else if(typeof t.ActiveXObject!=q)try{var h=new ActiveXObject("ShockwaveFlash.ShockwaveFlash");if(h&&(g=h.GetVariable("$version")))f=!0,g=g.split(" ")[1].split(","),
e=[parseInt(g[0],10),parseInt(g[1],10),parseInt(g[2],10)]}catch(i){}return{w3:a,pv:e,wk:b,ie:f,win:d,mac:c}}();(function(){j.w3&&((typeof k.readyState!=q&&"complete"==k.readyState||typeof k.readyState==q&&(k.getElementsByTagName("body")[0]||k.body))&&a(),A||(typeof k.addEventListener!=q&&k.addEventListener("DOMContentLoaded",a,!1),j.ie&&j.win&&(k.attachEvent("onreadystatechange",function(){"complete"==k.readyState&&(k.detachEvent("onreadystatechange",arguments.callee),a())}),t==top&&function(){if(!A){try{k.documentElement.doScroll("left")}catch(b){setTimeout(arguments.callee,
0);return}a()}}()),j.wk&&function(){A||(/loaded|complete/.test(k.readyState)?a():setTimeout(arguments.callee,0))}(),c(a)))})();(function(){j.ie&&j.win&&window.attachEvent("onunload",function(){for(var a=B.length,b=0;b<a;b++)B[b][0].detachEvent(B[b][1],B[b][2]);a=H.length;for(b=0;b<a;b++)s(H[b]);for(var c in j)j[c]=null;j=null;for(var d in swfobject)swfobject[d]=null;swfobject=null})})();return{registerObject:function(a,b,c,d){if(j.w3&&a&&b){var f={};f.id=a;f.swfVersion=b;f.expressInstall=c;f.callbackFn=
d;z[z.length]=f;u(a,!1)}else d&&d({success:!1,id:a})},getObjectById:function(a){if(j.w3)return f(a)},embedSWF:function(a,c,d,f,e,h,l,k,s,n){var o={success:!1,id:c};j.w3&&!(j.wk&&312>j.wk)&&a&&c&&d&&f&&e?(u(c,!1),b(function(){d+="";f+="";var b={};if(s&&typeof s===w)for(var j in s)b[j]=s[j];b.data=a;b.width=d;b.height=f;j={};if(k&&typeof k===w)for(var r in k)j[r]=k[r];if(l&&typeof l===w)for(var v in l)j.flashvars=typeof j.flashvars!=q?j.flashvars+("&"+v+"="+l[v]):v+"="+l[v];if(m(e))r=p(b,j,c),b.id==
c&&u(c,!0),o.success=!0,o.ref=r;else{if(h&&i()){b.data=h;g(b,j,c,n);return}u(c,!0)}n&&n(o)})):n&&n(o)},switchOffAutoHideShow:function(){N=!1},ua:j,getFlashPlayerVersion:function(){return{major:j.pv[0],minor:j.pv[1],release:j.pv[2]}},hasFlashPlayerVersion:m,createSWF:function(a,b,c){if(j.w3)return p(a,b,c)},showExpressInstall:function(a,b,c,d){j.w3&&i()&&g(a,b,c,d)},removeSWF:function(a){j.w3&&s(a)},createCSS:function(a,b,c,d){j.w3&&r(a,b,c,d)},addDomLoadEvent:b,addLoadEvent:c,getQueryParamValue:function(a){var b=
k.location.search||k.location.hash;if(b){/\?/.test(b)&&(b=b.split("?")[1]);if(null==a)return v(b);for(var b=b.split("&"),c=0;c<b.length;c++)if(b[c].substring(0,b[c].indexOf("="))==a)return v(b[c].substring(b[c].indexOf("=")+1))}return""},expressInstallCallback:function(){if(F){var a=o(K);if(a&&C){a.parentNode.replaceChild(C,a);if(G&&(u(G,!0),j.ie&&j.win))C.style.display="block";I&&I(M)}F=!1}}}}();function FABridge(a,b){this.target=a;this.remoteTypeCache={};this.remoteInstanceCache={};this.remoteFunctionCache={};this.localFunctionCache={};this.bridgeID=FABridge.nextBridgeID++;this.name=b;this.nextLocalFuncID=0;FABridge.instances[this.name]=this;FABridge.idMap[this.bridgeID]=this;return this}FABridge.TYPE_ASINSTANCE=1;FABridge.TYPE_ASFUNCTION=2;FABridge.TYPE_JSFUNCTION=3;FABridge.TYPE_ANONYMOUS=4;FABridge.initCallbacks={};FABridge.userTypes={};
FABridge.addToUserTypes=function(){for(var a=0;a<arguments.length;a++)FABridge.userTypes[arguments[a]]={typeName:arguments[a],enriched:!1}};FABridge.argsToArray=function(a){for(var b=[],c=0;c<a.length;c++)b[c]=a[c];return b};function instanceFactory(a){this.fb_instance_id=a;return this}function FABridge__invokeJSFunction(a){var b=a[0],a=a.concat();a.shift();return FABridge.extractBridgeFromID(b).invokeLocalFunction(b,a)}
FABridge.addInitializationCallback=function(a,b){var c=FABridge.instances[a];void 0!=c?b.call(c):(c=FABridge.initCallbacks[a],null==c&&(FABridge.initCallbacks[a]=c=[]),c.push(b))};
function FABridge__bridgeInitialized(a){var b=document.getElementsByTagName("object"),c=b.length,d=[];if(0<c)for(var e=0;e<c;e++)"undefined"!=typeof b[e].SetVariable&&(d[d.length]=b[e]);c=document.getElementsByTagName("embed");e=c.length;b=[];if(0<e)for(var f=0;f<e;f++)"undefined"!=typeof c[f].SetVariable&&(b[b.length]=c[f]);f=d.length;c=b.length;e="bridgeName="+a;if(1==f&&!c||1==f&&1==c)FABridge.attachBridge(d[0],a);else if(1==c&&!f)FABridge.attachBridge(b[0],a);else{var i=!1;if(1<f)for(var g=0;g<
f;g++){for(var h=d[g].childNodes,l=0;l<h.length;l++){var p=h[l];if(1==p.nodeType&&"param"==p.tagName.toLowerCase()&&"flashvars"==p.name.toLowerCase()&&0<=p.value.indexOf(e)){FABridge.attachBridge(d[g],a);i=!0;break}}if(i)break}if(!i&&1<c)for(d=0;d<c;d++)if(0<=b[d].attributes.getNamedItem("flashVars").nodeValue.indexOf(e)){FABridge.attachBridge(b[d],a);break}}return!0}FABridge.nextBridgeID=0;FABridge.instances={};FABridge.idMap={};FABridge.refCount=0;
FABridge.extractBridgeFromID=function(a){return FABridge.idMap[a>>16]};FABridge.attachBridge=function(a,b){var c=new FABridge(a,b);FABridge[b]=c;var d=FABridge.initCallbacks[b];if(null!=d){for(var e=0;e<d.length;e++)d[e].call(c);delete FABridge.initCallbacks[b]}};FABridge.blockedMethods={toString:!0,get:!0,set:!0,call:!0};
FABridge.prototype={root:function(){return this.deserialize(this.target.getRoot())},releaseASObjects:function(){return this.target.releaseASObjects()},releaseNamedASObject:function(a){return"object"!=typeof a?!1:this.target.releaseNamedASObject(a.fb_instance_id)},create:function(a){return this.deserialize(this.target.create(a))},makeID:function(a){return(this.bridgeID<<16)+a},getPropertyFromAS:function(a,b){if(0<FABridge.refCount)throw Error("You are trying to call recursively into the Flash Player which is not allowed. In most cases the JavaScript setTimeout function, can be used as a workaround.");
FABridge.refCount++;retVal=this.target.getPropFromAS(a,b);retVal=this.handleError(retVal);FABridge.refCount--;return retVal},setPropertyInAS:function(a,b,c){if(0<FABridge.refCount)throw Error("You are trying to call recursively into the Flash Player which is not allowed. In most cases the JavaScript setTimeout function, can be used as a workaround.");FABridge.refCount++;retVal=this.target.setPropInAS(a,b,this.serialize(c));retVal=this.handleError(retVal);FABridge.refCount--;return retVal},callASFunction:function(a,
b){if(0<FABridge.refCount)throw Error("You are trying to call recursively into the Flash Player which is not allowed. In most cases the JavaScript setTimeout function, can be used as a workaround.");FABridge.refCount++;retVal=this.target.invokeASFunction(a,this.serialize(b));retVal=this.handleError(retVal);FABridge.refCount--;return retVal},callASMethod:function(a,b,c){if(0<FABridge.refCount)throw Error("You are trying to call recursively into the Flash Player which is not allowed. In most cases the JavaScript setTimeout function, can be used as a workaround.");
FABridge.refCount++;c=this.serialize(c);retVal=this.target.invokeASMethod(a,b,c);retVal=this.handleError(retVal);FABridge.refCount--;return retVal},invokeLocalFunction:function(a,b){var c,d=this.localFunctionCache[a];void 0!=d&&(c=this.serialize(d.apply(null,this.deserialize(b))));return c},getTypeFromName:function(a){return this.remoteTypeCache[a]},createProxy:function(a,b){var c=this.getTypeFromName(b);instanceFactory.prototype=c;c=new instanceFactory(a);return this.remoteInstanceCache[a]=c},getProxy:function(a){return this.remoteInstanceCache[a]},
addTypeDataToCache:function(a){newType=new ASProxy(this,a.name);for(var b=a.accessors,c=0;c<b.length;c++)this.addPropertyToType(newType,b[c]);a=a.methods;for(c=0;c<a.length;c++)void 0==FABridge.blockedMethods[a[c]]&&this.addMethodToType(newType,a[c]);return this.remoteTypeCache[newType.typeName]=newType},addPropertyToType:function(a,b){var c=b.charAt(0),d;"a"<=c&&"z">=c?(d="get"+c.toUpperCase()+b.substr(1),c="set"+c.toUpperCase()+b.substr(1)):(d="get"+b,c="set"+b);a[c]=function(a){this.bridge.setPropertyInAS(this.fb_instance_id,
b,a)};a[d]=function(){return this.bridge.deserialize(this.bridge.getPropertyFromAS(this.fb_instance_id,b))}},addMethodToType:function(a,b){a[b]=function(){return this.bridge.deserialize(this.bridge.callASMethod(this.fb_instance_id,b,FABridge.argsToArray(arguments)))}},getFunctionProxy:function(a){var b=this;null==this.remoteFunctionCache[a]&&(this.remoteFunctionCache[a]=function(){b.callASFunction(a,FABridge.argsToArray(arguments))});return this.remoteFunctionCache[a]},getFunctionID:function(a){if(void 0==
a.__bridge_id__)a.__bridge_id__=this.makeID(this.nextLocalFuncID++),this.localFunctionCache[a.__bridge_id__]=a;return a.__bridge_id__},serialize:function(a){var b={},c=typeof a;if("number"==c||"string"==c||"boolean"==c||null==c||void 0==c)b=a;else if(a instanceof Array){b=[];for(c=0;c<a.length;c++)b[c]=this.serialize(a[c])}else"function"==c?(b.type=FABridge.TYPE_JSFUNCTION,b.value=this.getFunctionID(a)):a instanceof ASProxy?(b.type=FABridge.TYPE_ASINSTANCE,b.value=a.fb_instance_id):(b.type=FABridge.TYPE_ANONYMOUS,
b.value=a);return b},deserialize:function(a){var b,c=typeof a;if("number"==c||"string"==c||"boolean"==c||null==a||void 0==a)b=this.handleError(a);else if(a instanceof Array){b=[];for(c=0;c<a.length;c++)b[c]=this.deserialize(a[c])}else if("object"==c){for(c=0;c<a.newTypes.length;c++)this.addTypeDataToCache(a.newTypes[c]);for(var d in a.newRefs)this.createProxy(d,a.newRefs[d]);if(a.type==FABridge.TYPE_PRIMITIVE)b=a.value;else if(a.type==FABridge.TYPE_ASFUNCTION)b=this.getFunctionProxy(a.value);else if(a.type==
FABridge.TYPE_ASINSTANCE)b=this.getProxy(a.value);else if(a.type==FABridge.TYPE_ANONYMOUS)b=a.value}return b},addRef:function(a){this.target.incRef(a.fb_instance_id)},release:function(a){this.target.releaseRef(a.fb_instance_id)},handleError:function(a){if("string"==typeof a&&0==a.indexOf("__FLASHERROR"))throw a=a.split("||"),0<FABridge.refCount&&FABridge.refCount--,Error(a[1]);return a}};ASProxy=function(a,b){this.bridge=a;this.typeName=b;return this};
ASProxy.prototype={get:function(a){return this.bridge.deserialize(this.bridge.getPropertyFromAS(this.fb_instance_id,a))},set:function(a,b){this.bridge.setPropertyInAS(this.fb_instance_id,a,b)},call:function(a,b){this.bridge.callASMethod(this.fb_instance_id,a,b)},addRef:function(){this.bridge.addRef(this)},release:function(){this.bridge.release(this)}};(function(){function a(a,c){return function(f){var i=new b;i.initEvent(c,!0,!0);i.target=i.currentTarget=a;for(var g in f)i[g]=f[g];a.dispatchEvent(i,arguments)}}function b(){}if(!window.WebSocket){var c=window.console;c||(c={log:function(){},error:function(){}});(function(){if("navigator"in window&&"plugins"in navigator&&navigator.plugins["Shockwave Flash"])return!!navigator.plugins["Shockwave Flash"].description;if("ActiveXObject"in window)try{return!!(new ActiveXObject("ShockwaveFlash.ShockwaveFlash")).GetVariable("$version")}catch(a){}return!1})()?
(WebSocket=function(a,b,f,i,g){var h=this;h.readyState=WebSocket.CONNECTING;h.bufferedAmount=0;WebSocket.__addTask(function(){h.__flash=WebSocket.__flash.create(a,b,f||null,i||0,g||null);h.__flash.addEventListener("open",function(){try{if(h.onopen)h.onopen()}catch(a){c.error(a.toString())}});h.__flash.addEventListener("close",function(){try{if(h.onclose)h.onclose()}catch(a){c.error(a.toString())}});h.__flash.addEventListener("message",function(a){a=decodeURIComponent(a.getData());try{if(h.onmessage){var b;
window.MessageEvent?(b=document.createEvent("MessageEvent"),b.initMessageEvent("message",!1,!1,a,null,null,window)):b={data:a};h.onmessage(b)}}catch(d){c.error(d.toString())}});h.__flash.addEventListener("stateChange",function(a){try{h.readyState=a.getReadyState(),h.bufferedAmount=a.getBufferedAmount()}catch(b){c.error(b.toString())}})})},WebSocket.prototype.send=function(a){if(!this.__flash||this.readyState==WebSocket.CONNECTING)throw"INVALID_STATE_ERR: Web Socket connection has not been established";
a=this.__flash.send(a);if(0>a)return!0;this.bufferedAmount=a;return!1},WebSocket.prototype.close=function(){if(this.__flash&&this.readyState==WebSocket.OPEN&&(this.__flash.close(),this.readyState=WebSocket.CLOSED,this.onclose))this.onclose()},WebSocket.prototype.addEventListener=function(b,c){if(!("__events"in this))this.__events={};if(!(b in this.__events)&&(this.__events[b]=[],"function"==typeof this["on"+b]))this.__events[b].defaultHandler=this["on"+b],this["on"+b]=a(this,b);this.__events[b].push(c)},
WebSocket.prototype.removeEventListener=function(a,b){if(!("__events"in this))this.__events={};if(a in this.__events)for(var c=this.__events.length;-1<c;--c)if(b===this.__events[a][c]){this.__events[a].splice(c,1);break}},WebSocket.prototype.dispatchEvent=function(a){if(!("__events"in this))throw"UNSPECIFIED_EVENT_TYPE_ERR";if(!(a.type in this.__events))throw"UNSPECIFIED_EVENT_TYPE_ERR";for(var b=0,c=this.__events[a.type].length;b<c&&!(this.__events[a.type][b](a),a.cancelBubble);++b);!1!==a.returnValue&&
"function"==typeof this.__events[a.type].defaultHandler&&this.__events[a.type].defaultHandler(a)},b.prototype.cancelable=!0,b.prototype.cancelBubble=!1,b.prototype.preventDefault=function(){if(this.cancelable)this.returnValue=!1},b.prototype.stopPropagation=function(){this.cancelBubble=!0},b.prototype.initEvent=function(a,b,c){this.type=a;this.cancelable=c;this.timeStamp=new Date},WebSocket.CONNECTING=0,WebSocket.OPEN=1,WebSocket.CLOSED=2,WebSocket.__tasks=[],WebSocket.__initialize=function(){if(!WebSocket.__swfLocation)WebSocket.__swfLocation=
"js/WebSocketMain.swf";var a=document.createElement("div");a.id="webSocketContainer";a.style.position="absolute";a.style.left="-100px";a.style.top="-100px";var b=document.createElement("div");b.id="webSocketFlash";a.appendChild(b);document.body.appendChild(a);swfobject.embedSWF(WebSocket.__swfLocation,"webSocketFlash","8","8","9.0.0",null,{bridgeName:"webSocket"},null,null,function(a){a.success||c.error("[WebSocket] swfobject.embedSWF failed")});FABridge.addInitializationCallback("webSocket",function(){try{WebSocket.__flash=
FABridge.webSocket.root();WebSocket.__flash.setCallerUrl(location.href);for(var a=0;a<WebSocket.__tasks.length;++a)WebSocket.__tasks[a]();WebSocket.__tasks=[]}catch(b){c.error("[WebSocket] "+b.toString())}})},WebSocket.__addTask=function(a){WebSocket.__flash?a():WebSocket.__tasks.push(a)},window.addEventListener?window.addEventListener("load",WebSocket.__initialize,!1):window.attachEvent("onload",WebSocket.__initialize)):c.error("Flash Player is not installed.")}})();var App=function(a){var b=""==window.location.host;a.App.init({url:"EmEm.chat",ws_host:b?"localhost":"192.168.1.1",ws_port:"8080",max_retries:8,debug:b,is_local:b});if(!a.App.get("debug")&&document.location.hostname!=a.App.get("url"))document.location="http://"+a.App.get("url");return{ChatEvents:function(b){var d={},e;for(e in b)d[e]=$$.Event(b[e]);this.fire=function(b,c){var e=d[b];return e?(e.context=c,a.App.get("debug")&&console.log(e.type,e),document.dispatchEvent(e)):!1};this.subscribe=function(a,
b){var c=d[a];return c?document.addEventListener(c.type,b,!1):!1}}}}(LUNGO);App.Data=function(a,b){var c=function(){var a={};this.count=0;this.has_key=function(b){return b in a};this.fetch=function(b){return a[b]};this.push=function(b,c){return!(b in a)?(a[b]=c,this.count++,!0):!1};this.remove=function(b){return b in a?(delete a[b],this.count--,!0):!1}},d=function(){function a(b,c){var e=d.fetch(b.id);null==e?(this.active=!0,this.isSelf=c,this.id=b.id,this.mac=b.mac,this.name=b.hostname,this.ip=b.ip,this.save(),e=this):e.activate();return e}var d=new c,e=new b.ChatEvents({create:"user_create",
update:"user_update",remove:"user_remove"});a.prototype={constructor:a,key:function(){return this.id},save:function(){d.push(this.key(),this)&&e.fire("create",this)},activate:function(){if(!this.active)this.active=!0,e.fire("update",this)},deactivate:function(){if(this.active)this.active=!1,e.fire("update",this)}};a.find=function(a){return d.fetch(a)};a.remove=function(a){if(a=this.find(a))a.deactivate(),d.remove(a.key()),e.fire("remove",a)};a.count=function(){return d.count};a.Events={subscribe:e.subscribe};
return a}(),e=function(){function a(b,c){this.id=e.count;this.user_id=b;this.message=c;this.user=d.find(this.user_id);this.save()}var e=new c,g=new b.ChatEvents({create:"message_create"});a.prototype={constructor:a,save:function(){e.push(this.key(),this)&&g.fire("create",this)},key:function(){return this.id},count:function(){return e.count}};a.send=function(a){b.Services.wsocket.send({type:"message",data:{message:a}})};a.count=function(){return e.count};a.Events={subscribe:g.subscribe};return a}();
return{User:d,Message:e}}(LUNGO,App);App.View=function(a,b){var c=function(b){var c=a.dom("#"+b),d=c.children().first(),e=a.dom("footer, header"),f=c.parent(),i=c.siblings(),n=function(){var a=f.height();0<e.length&&(a-=e.height());0<i.length&&(a-=i.height());return a};this.refreshHeight=function(){c.style("height",n()+"px")};a.dom(document).ready(this.refreshHeight);this.scroll=new iScroll(b,{snap:"li",momentum:!0,bounce:!0,hideScrollbar:!1,hScrollbar:!1,vScrollbar:!0});this.scrollNeeded=function(){return d.height()>c.height()}},d=
function(){var d=new c("messages"),e=null,f=a.dom("#messages_tab span.bubble.count");a.View.Template.create("message",'<li id="{{id}}" class="message {{li_class}}">        {{name}}        {{message}}      </li>');a.View.Template.create("user_msg",'<li id="{{id}}" class="user_msg">        <div class="onright">          <span class="bubble count">            <span class="icon {{icon}}"></span>{{action}}          </span>        </div>        {{name}}      </li>');var i=!1,s=function(a){var b=e&&e==a?
i:!i,b=(i=b)?"even":"odd";if(!e||e!=a)b+=" switch";return b},o=1,n=function(a){setTimeout(function(){d.scroll.refresh();d.scrollNeeded()&&d.scroll.scrollToElement(document.getElementById(a),750)},0)};return{render:function(c){var d="message_"+o++;a.View.Template.Binding.append("messages_list","message",{id:d,name:e!=c.user?'<div class="onright"><span class="bubble count"><span class="icon chat"></span>'+c.user.name+"</span></div>":"",message:c.message.replace(/<(?:.|\n)*?>/gm,""),li_class:s(c.user)});
e=c.user;n(d);c=b.Data.Message.count();f.text(""+c)},renderUserAction:function(b){if(!b.isSelf){var c="message_"+o++;a.View.Template.Binding.append("messages_list","user_msg",{id:c,icon:b.active?"plus":"substract",name:b.name,action:"user "+(b.active?"joined":"left")});n(c)}}}}(),e=function(){var b=new c("users"),e=a.dom("#users_tab span.bubble.count");a.View.Template.create("user",'<li id="user_{{id}}" class="{{user_class}}">        <span class="icon user"></span>        <div class="onright"><span class="state bubble count online">{{active}}</span></div>        {{name}}        <small>{{ip}}</small>      </li>');
var f=function(a){setTimeout(function(){b.scroll.refresh();b.scrollNeeded()&&b.scroll.scrollToElement(document.getElementById(a),750)},0)},i={};return{render:function(b){if(i[b.id]){var c=a.dom("#user_"+b.id+" .state");c.html(b.active?"online":"offline");b.active?c.removeClass("offline").addClass("online"):c.removeClass("online").addClass("offline")}else a.View.Template.Binding.append("users_list","user",{id:b.id,name:b.name,ip:b.ip,active:b.active?"online":"offline",user_class:b.isSelf?"self":"other"}),
f("user_"+b.id),i[b.id]=a.dom("#user_"+b.id);d.renderUserAction(b)},setConnectedCount:function(a){e.text(""+a)}}}(),f={$input:a.dom("#chat_input"),value:function(){return this.$input.val()},enable:function(){this.$input.each(function(){this.removeAttribute("disabled")});this.$input.val("");this.$input.get(0).focus()},disable:function(){this.$input.attr("disabled","disabled")},onInput:function(a){this.$input.get(0).addEventListener("change",a,!1)}},i=function(){var b=!1,c=[],d=function(){b=!1;f()},
e=function(b){return function(){b?(a.Sugar.Growl.hide(),setTimeout(d,300)):d()}},f=function(){if(!b){var d=c.pop();d&&(b=!0,a.Sugar.Growl.hide(),setTimeout(d,300))}},i=function(a){c.unshift(a);f()};return{normal:function(b,c,d,f,g){var h=d||2,g=g||"info";i(function(){a.Sugar.Growl.notify(b,c,g,null,h,e(f))})},warn:function(b,c,d,f,g){var h=d||2,g=g||"exclamation";i(function(){a.Sugar.Growl.show(b,c,g,!1,h,e(f))})},hide:function(){i(e(!0))}}}();return{Message:d,User:e,Input:f,Info:i,Effects:{fadeInTitle:function(){a.dom("#asciititle")}}}}(LUNGO,
App);App.Services=function(a,b){var c={join:function(a){new b.Data.User(a.user,a.is_self)},leave:function(a){b.Data.User.remove(a.id)},message:function(a){new b.Data.Message(a.user_id,a.message)}},d=function(){var e="MozWebSocket"in window?MozWebSocket:WebSocket,f=new b.ChatEvents({before_connect:"wsocket_before_connect",after_connect:"wsocket_after_connect",disconnect:"wsocket_disconnect",fail_connect:"wsocket_fail_connect"}),i=null,g=0,h=function(){return null!=i&&i.readyState==e.OPEN},l=function(){if(!h())g++,
f.fire("before_connect",d),i=new e("ws://"+a.App.get("ws_host")+":"+a.App.get("ws_port")+"/"),i.onopen=s,i.onclose=o,i.handle_result=m,i.send_json=n,i.onmessage=r},p=function(){return g<=a.App.get("max_retries")?2*g:!1},s=function(){g=0;f.fire("after_connect",d)},o=function(){var a=p();!1!==a?(setTimeout(l,1E3*a),f.fire("disconnect",d)):f.fire("fail_connect",d)},n=function(a){i.send(JSON.stringify(a))},m=function(a){return c[a.type](a.data)},r=function(b){var c,d=!1;try{c=JSON.parse(b.data)}catch(e){d=
e}d||("array"===a.Core.toType(c)?$$.each(c,function(a){m(c[a])}):m(c))};return{active:h,connect:l,connect_attempts:function(){return g},retry_in_seconds:p,send:n,Events:{subscribe:f.subscribe}}}();return{wsocket:d}}(LUNGO,App);App.Events=function(a,b){a.dom(document).ready(function(){App.View.Input.disable();App.Services.wsocket.connect()});b.View.Input.onInput(function(){b.View.Input.disable();b.Data.Message.send(b.View.Input.value());b.View.Input.enable()});b.Services.wsocket.Events.subscribe("before_connect",function(a){a=a.context.connect_attempts();1==a?b.View.Info.warn("Connecting","Please wait",0.5,!1,"time"):5<=a&&b.View.Info.warn("Retrying to connect","Please wait",1,!1,"time")});b.Services.wsocket.Events.subscribe("after_connect",
function(){b.View.Input.enable();b.View.Info.hide();setTimeout(App.View.Effects.fadeInTitle,1E3)});b.Services.wsocket.Events.subscribe("disconnect",function(a){b.View.Input.disable();4<=a.context.connect_attempts()&&b.View.Info.warn("Unable to connect","Retrying in "+a.context.retry_in_seconds()+"s",1,!1)});b.Services.wsocket.Events.subscribe("fail_connect",function(){b.View.Info.warn("Failed to connect","",10,!0)});b.Data.User.Events.subscribe("create",function(a){b.View.User.setConnectedCount(b.Data.User.count());
b.View.User.render(a.context)});b.Data.User.Events.subscribe("remove",function(a){b.View.User.setConnectedCount(b.Data.User.count());b.View.User.render(a.context)});b.Data.Message.Events.subscribe("create",function(a){b.View.Message.render(a.context)});return{}}(LUNGO,App);
